<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Dashboard Page</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
            integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
            crossorigin="anonymous"
        />
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
            integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
            crossorigin="anonymous"
        ></script>
        <style>
            .row.content {
                height: 500px;
            }
            footer {
                background-color: #555;
                color: white;
                padding: 15px;
            }
        </style>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const form = document.getElementById("license_form");
                const updateForm = document.getElementById("updateUserForm");
                const updateFormParent =
                    document.getElementById("updateFormParent");

                form.addEventListener("submit", (event) => {
                    event.preventDefault(); // Prevent the default form submission
                    const l_no = document.getElementById("licenseNumber").value;

                    fetch(`http://localhost:3000/api/users/${l_no}`, {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                        },
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            if (data?.error) {
                                alert("No User Found");
                                window.location.href = "/g2";
                            } else {
                                alert("User Found Successfully");
                                updateForm.id.value = data._id;
                                updateForm.firstName.value = data.first_name;
                                updateForm.lastName.value = data.last_name;
                                updateForm.licenseNumber.value =
                                    data.license_no;
                                updateForm.age.value = data.age;
                                updateForm.make.value = data.car_details.make;
                                updateForm.model.value = data.car_details.model;
                                updateForm.year.value = data.car_details.year;
                                updateForm.plateNumber.value =
                                    data.car_details.plat_no;
                                updateFormParent.classList.remove("d-none");
                            }
                        })
                        .catch((error) => {
                            alert("No Data Found");
                            window.location.reload();
                            console.error(error);
                        });
                });

                updateForm.addEventListener("submit", (event) => {
                    event.preventDefault(); // Prevent the default form submission
                    const user_id = document.getElementById("id").value;
                    const formData = {
                        make: document.getElementById("make").value,
                        model: document.getElementById("model").value,
                        year: document.getElementById("year").value,
                        plat_no: document.getElementById("plateNumber").value,
                    };

                    fetch(`http://localhost:3000/api/users/${user_id}`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(formData),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            alert("Data Updated Successfully");
                            window.location.reload();
                        })
                        .catch((error) => {
                            console.error(error);
                            alert(error + "Data not updated successfully.");
                        });
                });
            });
        </script>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
            <a class="navbar-brand" href="/">BOOK DRIVE TEST</a>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/dashboard">DASHBOARD</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/g2">G_2 TEST</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/g">G TEST</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/login">LOGIN</a>
                </li>
            </ul>
        </nav>

        <div class="container-fluid text-center">
            <div class="row justify-content-center">
                <div class="col-md-6 my-5">
                    <div class="card">
                        <div class="card-header">License Lookup</div>
                        <div class="card-body">
                            <form class="text-start" id="license_form">
                                <div class="form-group p-2">
                                    <label for="licenseNumber" class="py-2"
                                        >License Number</label
                                    >
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="licenseNumber"
                                        placeholder="Enter License Number"
                                    />
                                </div>
                                <button
                                    type="submit"
                                    class="m-2 btn btn-primary"
                                >
                                    Lookup
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-10 my-5 d-none" id="updateFormParent">
                    <div class="card">
                        <div class="card-header">Update User Details</div>
                        <div class="card-body">
                            <!-- Personal Information Section -->
                            <h5 class="card-title mt-3">
                                Personal Information (You are not able to update
                                Personal Details)
                            </h5>
                            <form class="text-start" id="updateUserForm">
                                <div class="form-row">
                                    <div
                                        class="form-group my-2 col-md-12 d-none"
                                    >
                                        <label for="firstName">User Id</label>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="id"
                                            disabled
                                            placeholder="User Unique Id"
                                        />
                                    </div>
                                    <div class="form-group my-2 col-md-12">
                                        <label for="firstName"
                                            >First Name</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="firstName"
                                            disabled
                                            placeholder="First Name"
                                        />
                                    </div>
                                    <div class="form-group my-2 col-md-12">
                                        <label for="lastName">Last Name</label>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="lastName"
                                            disabled
                                            placeholder="Last Name"
                                        />
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group my-2 col-md-12">
                                        <label for="licenseNumber"
                                            >License Number</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="licenseNumber"
                                            disabled
                                            placeholder="License Number (8 characters)"
                                        />
                                    </div>
                                    <div class="form-group my-2 col-md-12">
                                        <label for="age">Age</label>
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="age"
                                            disabled
                                            placeholder="Age"
                                        />
                                    </div>
                                </div>

                                <!-- Car Information Section -->
                                <h5 class="card-title text-center mt-5">
                                    Car Information
                                </h5>

                                <div class="form-row">
                                    <div class="form-group my-2 col-md-12">
                                        <label for="make">Make</label>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="make"
                                            placeholder="Car Make"
                                        />
                                    </div>
                                    <div class="form-group my-2 col-md-12">
                                        <label for="model">Model</label>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="model"
                                            placeholder="Car Model"
                                        />
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group my-2 col-md-12">
                                        <label for="year">Year</label>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="year"
                                            placeholder="Car Year"
                                        />
                                    </div>
                                    <div class="form-group my-2 col-md-12">
                                        <label for="plateNumber"
                                            >Plate Number</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="plateNumber"
                                            placeholder="Plate Number"
                                        />
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <button type="submit" class="btn btn-primary">
                                    Submit
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container-fluid text-center">
            <p>Update soon</p>
        </footer>
    </body>
</html>
